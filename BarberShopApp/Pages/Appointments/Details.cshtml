@page
@model BarberShopApp.Pages.Appointments.DetailsModel

@{
    ViewData["Title"] = "Detalles de Cita";
    // 1. Declaramos la variable en el bloque principal @{...}
    // con un valor por defecto. Esto garantiza que exista globalmente.
    string badgeClass = "bg-secondary";

    if (Model.Appointment != null)
    {
        badgeClass = Model.Appointment.Status switch
        {
            "Confirmada" => "bg-success",
            "Pendiente" => "bg-warning text-dark",
            "Cancelada" => "bg-danger",
            _ => "bg-secondary"
        };
    }
}

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">

            @if (Model.Appointment != null)
            {

                <header class="d-flex justify-content-between align-items-center mb-5 pb-2 border-bottom">
                    <h1 class="display-6 fw-light text-dark">
                        <i class="bi bi-calendar-check me-2 text-dark"></i> @ViewData["Title"]
                    </h1>
                    <span class="badge @badgeClass fs-6 p-2 shadow-sm">
                        <i class="bi bi-info-circle me-1"></i> Estado: @Model.Appointment.Status
                    </span>
                </header>

                <div class="p-4 p-md-5 shadow-lg rounded-4 bg-white border border-2">

                    <h4 class="mb-4 text-dark border-bottom pb-2">Información de la Reserva</h4>

                    <ul class="list-group list-group-flush mb-4">

                        <li class="list-group-item d-flex justify-content-between align-items-center px-0 bg-white">
                            <span class="text-muted fw-bold fs-5"><i class="bi bi-clock me-2 text-dark"></i> Fecha y Hora:</span>
                            <span class="fw-bolder fs-5 text-dark">@Model.Appointment.DateTime.ToString("dddd, dd MMMM yyyy, HH:mm")</span>
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center px-0 bg-white">
                            <span class="text-muted fw-bold"><i class="bi bi-person-fill me-2"></i> Cliente:</span>
                            <span class="text-dark">@Html.DisplayFor(model => model.Appointment.ClientName)</span>
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center px-0 bg-white">
                            <span class="text-muted"><i class="bi bi-envelope me-2"></i> Email:</span>
                            <span class="text-dark">@Html.DisplayFor(model => model.Appointment.ClientEmail)</span>
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center px-0 bg-white">
                            <span class="text-muted"><i class="bi bi-person-circle me-2"></i> Barbero:</span>
                            <span class="text-dark">@Html.DisplayFor(model => model.Appointment.Barber!.Name)</span>
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center px-0 bg-white">
                            <span class="text-muted"><i class="bi bi-scissors me-2"></i> Servicio:</span>
                            <span class="text-dark">
                                @Html.DisplayFor(model => model.Appointment.Service!.Name)
                                <span class="badge bg-secondary ms-2">@Model.Appointment.Service!.DurationMinutes minutos</span>
                            </span>
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center px-0 bg-white small text-muted border-top mt-3">
                            <span>ID de Cita: <span class="fw-normal text-dark">@Html.DisplayFor(model => model.Appointment.AppointmentId)</span></span>
                            <span>ID de Tenant: <span class="fw-normal text-dark">@Html.DisplayFor(model => model.Appointment.TenantId)</span></span>
                        </li>
                    </ul>

                </div>

                <div class="d-flex justify-content-between align-items-center mt-4">
                    <a asp-page="./Index" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-2"></i> Volver al Listado
                    </a>
                    <a asp-page="./Edit" asp-route-id="@Model.Appointment.AppointmentId" class="btn btn-dark shadow-sm">
                        <i class="bi bi-pencil-fill me-2"></i> Editar Cita
                    </a>
                </div>

            }
            else
            {
                <div class="alert alert-danger text-center" role="alert">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i> No se encontró la cita solicitada.
                </div>
            }

        </div>
    </div>
</div>